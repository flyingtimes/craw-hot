# Session: 2026-02-28 11:37:00 UTC

- **Session Key**: agent:main:main
- **Session ID**: n/a
- **Source**: craw-hot 技能优化

## 问题

当用户24小时内没有发新帖时，craw-hot 技能会反复重试，多次打开同一个用户的主页，浪费时间。

**日志示例（修改前）：**
```
[2026-02-28 11:28:57] [INFO] Collected 0 URLs for @ModdedQuad
[2026-02-28 11:28:57] [DEBUG] Attempt 2/5
[2026-02-28 11:28:57] [INFO] Navigating to https://x.com/ModdedQuad
[2026-02-28 11:29:00] [DEBUG] Scroll 1/10
[2026-02-28 11:29:01] [INFO] Collected 0 URLs for @ModdedQuad
[2026-02-28 11:29:01] [DEBUG] Attempt 3/5
[2026-02-28 11:29:02] [INFO] Navigating to https://x.com/ModdedQuad
...
```

同一个用户会被重试 5 次，每次都返回空列表。

## 解决方案

**craw-hot 技能 v2.2 优化**

### 1. 新增异常类
```python
class NoPostsFoundError(Exception):
    """没有找到帖子的异常（用于区分真正的失败和正常情况）"""
    pass
```

### 2. 修改 `crawl_user_posts` 方法
在 `_crawl_internal()` 中，当没有帖子时抛出 `NoPostsFoundError`：

```python
def crawl_user_posts(self, username: str) -> List[str]:
    def _crawl_internal():
        if not self.ensure_browser():
            raise Exception("Browser not available")

        if not self._navigate_to_user(username):
            raise Exception(f"Failed to navigate to @{username}")

        urls = self._scroll_and_collect_urls(username)

        # 如果没有帖子，抛出 NoPostsFoundError（这不算失败）
        if not urls:
            raise NoPostsFoundError(f"No posts found for @{username} in the last 24 hours")

        return urls

    # 尝试抓取
    try:
        result = self._retry_on_failure(_crawl_internal)
        return result if result else []
    except NoPostsFoundError:
        # 没有帖子是正常情况，返回空列表，不重试
        self.logger.info(f"@{username}: no posts found in the last 24 hours")
        return []
```

### 3. 修改 `_retry_on_failure` 方法
在异常处理中识别 `NoPostsFoundError` 并立即抛出（不重试）：

```python
def _retry_on_failure(self, func, *args, **kwargs) -> Optional[Dict]:
    for attempt in range(1, MAX_RETRIES + 1):
        try:
            self.logger.debug(f"Attempt {attempt}/{MAX_RETRIES}")
            result = func(*args, **kwargs)

            # 成功返回结果
            self.logger.debug("Success")
            return result
        except NoPostsFoundError:
            # 没有帖子不算失败，不重试，直接抛出
            raise
        except Exception as e:
            # 其他异常，正常重试逻辑
            ...
```

## 测试结果

**日志示例（修改后）：**
```
[2026-02-28 11:31:01] [INFO] Collected 0 URLs for @AIatMeta
[2026-02-28 11:31:01] [DEBUG] Success
[2026-02-28 11:31:01] [WARN] @AIatMeta: no posts found in last 24 hours  ← 直接跳过！
[2026-02-28 11:31:01] [DEBUG] Waiting 4.34s...
[2026-02-28 11:31:05] [INFO] Progress: 5/19 users
[2026-02-28 11:31:05] [INFO] Starting crawl for @AndrewYNg  ← 下一个用户！

[2026-02-28 11:31:16] [INFO] Collected 0 URLs for @AndrewYNg
[2026-02-28 11:31:16] [DEBUG] Success
[2026-02-28 11:31:16] [WARN] @AndrewYNg: no posts found in last 24 hours  ← 直接跳过！
[2026-02-28 11:31:16] [DEBUG] Waiting 2.55s...
[2026-02-28 11:31:18] [INFO] Progress: 6/19 users
[2026-02-28 11:31:18] [INFO] Starting crawl for @GoogleDeepMind  ← 下一个用户！
```

## 优势

✅ **节省时间**：没有帖子的用户不再重试 5 次
✅ **减少请求**：降低对 X.com 的请求压力
✅ **提高效率**：更快完成所有用户的抓取
✅ **日志清晰**：明确区分"没有帖子"和"真正失败"

## 当前状态

抓取任务正在顺利进行中，v2.2 优化已生效。
